# Trip Reports Website - Project Overview

## Project Description
A travel blog website showcasing flight reports, trip reports, and aviation enthusiast content. The site features interactive airline and aircraft information pages, a planespotting game, and detailed trip/flight reports.

## Project Structure

### Main Pages
- **index.html** - Homepage displaying all trip and flight reports with filtering by type, airline, and country
- **airline-info.html** - Searchable database of airlines with tail images, logos, and detailed information
- **aircraft-info.html** - Searchable database of aircraft types with template images
- **planespotting.html** - Interactive game where animated planes fly across the screen with airline tails

### Key Directories
```
tripreports.github.io/
├── css/
│   └── style.css              # Main stylesheet
├── js/
│   └── app.js                 # Main JavaScript for homepage
├── data/
│   ├── airlines.json          # Complete airline database
│   ├── aircraft_types.json    # Aircraft type specifications
│   └── iata_to_icao_mapping.json  # IATA→ICAO code conversion
├── images/
│   ├── tails/                 # Airline tail images (ICAO-named)
│   ├── aircraft_templates/    # Aircraft template images (169 total)
│   ├── icons/                 # UI icons and plane images
│   └── flights/               # Flight report images
└── posts/
    ├── flights/               # Individual flight report markdown files
    └── trips/                 # Individual trip report markdown files
```

## Core Concepts

### Airline Codes
- **IATA codes**: 2-character codes (e.g., "AA", "DL", "UA")
- **ICAO codes**: 3-4 character codes (e.g., "AAL", "DAL", "UAL")
- ICAO codes are more specific and preferred for tail image naming
- Some airlines share the same IATA code but have different ICAO codes
- Mapping file (`iata_to_icao_mapping.json`) handles conversions with tail availability prioritization

### Tail Images
- Located in `images/tails/`
- Named using **ICAO codes** (e.g., `AAL.png` for American Airlines)
- Special files:
  - `unknown.png` - Fallback for airlines without specific tails
  - Tail images are overlaid on `plane_notail.png` for the aircraft preview
- The `tailImages` array in each page lists all available tail codes

### Aircraft Images
- **Plane icons**:
  - `plane_notail.png` - Plane silhouette without tail (used with tail overlays)
  - `plane_tail.png` - Complete plane with generic tail (fallback when no specific tail exists)
- **Aircraft templates**: 169 aircraft type templates in `images/aircraft_templates/`, named by IATA code

### Image Display Logic
1. **Search Results Cards (Top Bar)**:
   - Shows actual tail image if available
   - Shows `unknown.png` if no tail exists

2. **Aircraft Preview (Detail View)**:
   - If tail exists: Shows `plane_notail.png` + tail overlay
   - If no tail exists: Shows `plane_tail.png` (complete plane with generic tail)

3. **Tail Display (Detail View Left Section)**:
   - Shows actual tail image if available
   - Falls back to `unknown.png`

## Data Files

### airlines.json
Complete database of airlines with fields:
- `Airline` - Full airline name
- `IATA` - 2-character IATA code
- `ICAO` - 3-4 character ICAO code
- `Call sign` - Radio callsign
- `Country/Region` - Operating country

### aircraft_types.json
Aircraft specifications with fields:
- `Aircraft` - Full aircraft name
- `IATA` - Aircraft type IATA code
- `ICAO` - Aircraft type ICAO code
- Additional specifications (manufacturer, capacity, etc.)

### iata_to_icao_mapping.json
Maps IATA codes to ICAO codes with the following logic:
- When multiple airlines share an IATA code, prioritizes the one with an available tail image
- Generated by `create_iata_icao_mapping.py` script

## Key Functions

### getTailImagePath(airlineCode)
Central function for resolving tail images:
1. Converts code to ICAO if possible
2. Checks if tail image exists in `tailImages` array
3. Falls back to checking original IATA code
4. Returns `unknown.png` if no tail found

### hasTailImage(airline)
Determines if an airline has a tail image available:
1. First checks airline's actual ICAO code
2. Then checks IATA code directly
3. Finally checks IATA→ICAO mapping (only if mapped code matches airline's ICAO or airline has no ICAO)
- Used for filtering airlines in the "Only airlines with tail images" filter

### getIcaoCode(iataCode)
Converts IATA code to ICAO using the mapping file:
- Returns mapped ICAO if exists
- Otherwise returns original code as-is

## Features

### Airline Info Page
- Search by airline name, IATA code, or ICAO code
- Filter for "Only airlines with tail images"
- Configurable results limit (20/50/100/All)
- Results count display
- Random airline button
- Detail view with:
  - Tail image display
  - Aircraft preview with tail overlay
  - Airline logo from avcodes.co.uk
  - Full airline information
- Back button with context awareness (returns to planespotting or search based on referrer)

### Aircraft Info Page
- Similar to airline info page
- Shows 169 aircraft templates
- Filter for "Only aircraft with templates"
- Aircraft detail view with specifications
- Attribution footer to Airline Empires

### Planespotting Page
- Animated planes fly across screen
- Random tail selections from available tails
- 10% chance of upside-down planes
- Angle constraints (±30 degrees from horizontal)
- Random scale (0.7-1.3x)
- Hover to reveal airline code
- Click to view airline info (with planespotting referrer)
- Random tail as favicon

### Homepage (index.html)
- Display all flight and trip reports
- Filter by type (flight/trip)
- Filter by airline (for flights)
- Filter by country (for trips)
- Airline filter bar with tail images
- Country flag icons
- Metadata displays with tail thumbnails for flights
- Parse markdown files from `posts/flights/` and `posts/trips/`

## Navigation
All pages include a consistent navigation bar with:
- Site title (links to home)
- Go Home
- Go Planespotting
- Airline Info
- Aircraft Info

## Important Implementation Details

### Duplicate IATA Handling
Some airlines share IATA codes (e.g., "3S" for both GUY and BOX):
- Only display airlines that have tail images when the filter is enabled
- Always use airline's actual ICAO code to fetch tail images, not the IATA code
- Prevents wrong tail from showing (e.g., BOX showing GUY's tail)

### Tail Image Priority
When determining which tail to show:
1. Use airline's actual ICAO code first
2. Fall back to airline's IATA code
3. Never use IATA→ICAO mapping unless it matches the airline's actual ICAO

### Error Handling
- All tail image elements have `onerror` handlers
- Fallback to `unknown.png` for failed loads
- Pre-checking against `tailImages` array prevents 404 errors

## Python Scripts
Located in root directory (for development/maintenance):
- `create_iata_icao_mapping.py` - Generates IATA→ICAO mapping with tail prioritization
- `cleanup_iata_tails.py` - Maintenance script for tail images
- `rename_tails_to_icao.py` - Converts tail filenames to ICAO codes
- `generate_tail_list.py` - Generates list of available tails
- `download_airline_logos.py` - Downloads airline logos
- Additional PSD conversion and scraping scripts

## Technologies Used
- Pure HTML/CSS/JavaScript (no frameworks)
- GitHub Flavored Markdown for posts
- Country flag emojis via Twemoji CDN
- Airline logos from avcodes.co.uk
- Aircraft templates from Airline Empires

## Design Patterns
- Single Page Application feel with view toggling
- Progressive enhancement with error handlers
- Data-driven with JSON files
- Responsive design with mobile breakpoints
- Consistent color scheme (aviation blue theme)

## Attribution
- Aircraft templates: Airline Empires
- Airline logos: avcodes.co.uk
- Country flags: Twemoji

## Development Notes
- Tail images are named by ICAO code for specificity
- Always check `tailImages` array before attempting to load
- Use `plane_notail.png` for overlays, `plane_tail.png` for complete fallback
- Maintain referrer parameter (`?ref=planespotting`) for back navigation
- Filter logic respects both search and filter settings
