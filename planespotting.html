<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Planespotting - Trip Reports</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" id="favicon">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #87CEEB 0%, #E0F6FF 100%);
            height: 100vh;
        }

        .plane-container {
            position: absolute;
            width: 150px;
            height: 150px;
            pointer-events: auto;
            z-index: 10;
            cursor: pointer;
        }

        .plane {
            width: 150px;
            height: auto;
            display: block;
        }

        .plane-tail {
            position: absolute;
            object-fit: contain;
            z-index: 1;
        }

        .plane-tail.right {
            top: -6px;
            left: -6.5px;
            width: 47.2px;
            height: 36.8px;
        }

        .plane-tail.left {
            top: -6px;
            right: -6.5px;
            width: 47.2px;
            height: 36.8px;
            transform: scaleX(-1);
        }

        .airline-code {
            position: absolute;
            font-size: 1.5rem;
            font-weight: bold;
            color: #555;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.5s ease-in;
            pointer-events: none;
            font-family: monospace;
        }

        .airline-code.revealed {
            opacity: 1;
        }

        .airline-code.fade-out {
            opacity: 0;
            transition: opacity 2s ease-out;
        }

        .help-icon {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 50px;
            height: 50px;
            background: rgba(44, 95, 141, 0.9);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: help;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: background 0.3s;
        }

        .help-icon:hover {
            background: rgba(30, 70, 102, 0.95);
        }

        .help-tooltip {
            position: fixed;
            bottom: 90px;
            left: 30px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.6;
            max-width: 300px;
            z-index: 1001;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .help-tooltip.visible {
            opacity: 1;
        }

        .help-tooltip p {
            margin: 0;
        }
    </style>
</head>
<body>
    <nav class="filter-nav">
        <div class="container">
            <h1 class="site-title"><a href="index.html" style="color: white; text-decoration: none;">Planespotting</a></h1>
            <div class="filter-buttons">
                <a href="index.html" class="filter-btn">Go Home</a>
                <a href="planespotting.html" class="filter-btn active">Go Planespotting</a>
                <a href="airline-info.html" class="filter-btn">Airline Info</a>
                <a href="aircraft-info.html" class="filter-btn">Aircraft Info</a>
            </div>
        </div>
    </nav>

    <div class="help-icon" id="help-icon">?</div>
    <div class="help-tooltip" id="help-tooltip">
        <p><strong>How to use:</strong><br>Hover over a plane to reveal its airline code.<br>Click on a plane to see more information.</p>
    </div>

    <script>
        // All tail images (ICAO codes + remaining IATA codes without ICAO equivalents)
        const tailImages = [
            '4Y', '8R', 'AAF', 'AAL', 'AAR', 'AAT', 'AB', 'ABJ', 'ABL', 'ABY', 'ACA', 'ACI',
            'ADM', 'ADR', 'AEA', 'AEE', 'AES', 'AFB', 'AFF', 'AFL', 'AFR', 'AGX', 'AIB', 'AIC',
            'AIQ', 'AIZ', 'AJX', 'AL', 'ALK', 'AMC', 'AMX', 'ANA', 'ANE', 'ANZ', 'APW', 'ARG',
            'ASA', 'ASL', 'AU', 'AUA', 'AUI', 'AUT', 'AVA', 'AVN', 'AWE', 'AWQ', 'AXM', 'AZA',
            'AZU', 'B0', 'BAV', 'BAW', 'BCY', 'BEE', 'BER', 'BF', 'BKP', 'BLF', 'BMI', 'BOI',
            'BON', 'BOV', 'BRU', 'BTI', 'BTK', 'BXI', 'BZH', 'CAL', 'CAW', 'CCA', 'CCM', 'CEB',
            'CES', 'CFE', 'CFG', 'CHH', 'CIX', 'CLH', 'CMP', 'CPA', 'CRK', 'CRL', 'CSA', 'CSC',
            'CSH', 'CSN', 'CSZ', 'CTN', 'CWC', 'CXA', 'DAH', 'DAL', 'DDL', 'DJ', 'DLA', 'DLH',
            'E9', 'EAQ', 'EDW', 'EGF', 'EIA', 'EIN', 'EJU', 'ELY', 'ENY', 'ETD', 'ETH', 'EVA',
            'EWG', 'EXS', 'EZD', 'EZE', 'FAJ', 'FDB', 'FFM', 'FFT', 'FIF', 'FIN', 'FLA', 'FLE',
            'FLI', 'FOS', 'FWI', 'GFA', 'GIA', 'GLO', 'GUY', 'HAL', 'HDA', 'HRH', 'HVN', 'IAD',
            'IBB', 'IBE', 'IBS', 'ICE', 'IGO', 'IRA', 'IRC', 'IRM', 'ITY', 'JAF', 'JAI', 'JAL',
            'JAT', 'JBU', 'JEC', 'JGO', 'JJP', 'JSA', 'JST', 'JW', 'KAC', 'KAL', 'KFR', 'KLA',
            'KLC', 'KLM', 'KQA', 'LAN', 'LAO', 'LBC', 'LBT', 'LGL', 'LH', 'LNI', 'LNK', 'LOG',
            'LOT', 'LPE', 'LPV', 'LVG', 'LZB', 'MAC', 'MAS', 'MAU', 'MDA', 'MDG', 'MEA', 'MHS',
            'MLT', 'MSR', 'MXD', 'NBT', 'NOK', 'NOZ', 'NTW', 'OAL', 'OAW', 'OF', 'OMA', 'ONE',
            'PAL', 'PD', 'PGA', 'PGT', 'PIC', 'PRZ', 'PSD', 'QFA', 'QG', 'QSC', 'QTR', 'RAM',
            'RCK', 'REU', 'RJA', 'ROT', 'ROU', 'RSL', 'RSR', 'RWD', 'RYR', 'RZO', 'S5', 'SAA',
            'SAS', 'SCW', 'SDG', 'SEJ', 'SEY', 'SFJ', 'SFR', 'SIA', 'SJX', 'SKU', 'SLK', 'SNG',
            'SUS', 'SVA', 'SWA', 'SWR', 'SYX', 'TAM', 'TAP', 'TAR', 'TGW', 'THA', 'THT', 'THY',
            'TJT', 'TLM', 'TNA', 'TOM', 'TSC', 'TT', 'TTW', 'TUA', 'TUX', 'TVF', 'TVS', 'TWN',
            'UAE', 'UAL', 'UIA', 'US', 'UZB', 'VAW', 'VIR', 'VJC', 'VLG', 'VOE', 'VOZ', 'VTA',
            'VTI', 'WAJ', 'WEN', 'WIF', 'WJA', 'WOW', 'WW', 'WZZ', 'XAX', 'XLA', 'XZ'
        ];

        const randomTail = tailImages[Math.floor(Math.random() * tailImages.length)];
        document.getElementById('favicon').href = `images/tails/${randomTail}.png`;

        // Help tooltip
        const helpIcon = document.getElementById('help-icon');
        const helpTooltip = document.getElementById('help-tooltip');

        helpIcon.addEventListener('mouseenter', () => {
            helpTooltip.classList.add('visible');
        });

        helpIcon.addEventListener('mouseleave', () => {
            helpTooltip.classList.remove('visible');
        });

        // Plane animation
        function createPlane() {
            // Create container
            const container = document.createElement('div');
            container.className = 'plane-container';

            // Create plane image
            const plane = document.createElement('img');
            plane.className = 'plane';

            // Create tail image
            const tail = document.createElement('img');
            tail.className = 'plane-tail';

            // Random tail selection
            const randomTail = tailImages[Math.floor(Math.random() * tailImages.length)];

            // Since randomTail is selected from tailImages array, we know it exists
            tail.src = `images/tails/${randomTail}.png`;
            tail.onerror = function() {
                // Fallback to unknown if the selected tail doesn't load
                this.onerror = null;
                this.src = 'images/tails/unknown.png';
            };

            // 10% chance of being upside down
            const upsideDown = Math.random() < 0.1;

            // Random direction: left to right or right to left
            const goingRight = Math.random() < 0.5;

            let startX, startY, endX, endY;

            // Always use plane_right.png and flip it for left-going planes
            plane.src = 'images/icons/plane_right.png';

            if (goingRight) {
                // Left to right
                tail.classList.add('right');
                startX = -150;
                endX = window.innerWidth + 150;
            } else {
                // Right to left - flip the plane horizontally
                plane.style.transform = 'scaleX(-1)';
                tail.classList.add('left');
                startX = window.innerWidth + 150;
                endX = -150;
            }

            // Random Y positions with angle constraint (±30 degrees from horizontal)
            // tan(30°) ≈ 0.577, so vertical change should be <= 0.577 * horizontal change
            // Pick a random starting Y
            startY = Math.random() * window.innerHeight;

            if (upsideDown) {
                // Upside down planes fly horizontally (no angle)
                endY = startY;
            } else {
                const horizontalDistance = Math.abs(endX - startX);
                const maxVerticalChange = horizontalDistance * 0.577; // tan(30°)

                // Constrain ending Y to maintain angle within ±30 degrees
                const minEndY = startY - maxVerticalChange;
                const maxEndY = startY + maxVerticalChange;

                // Clamp to screen bounds
                const clampedMinY = Math.max(0, minEndY);
                const clampedMaxY = Math.min(window.innerHeight, maxEndY);

                endY = clampedMinY + Math.random() * (clampedMaxY - clampedMinY);
            }

            container.style.left = startX + 'px';
            container.style.top = startY + 'px';

            // Calculate rotation angle (only vertical tilt, horizontal direction is in the image)
            let verticalAngle = Math.atan2(endY - startY, Math.abs(endX - startX)) * 180 / Math.PI;

            // For right-to-left planes, negate the angle since they're facing opposite
            if (!goingRight) {
                verticalAngle = -verticalAngle;
            }

            // Random scale between 0.7 and 1.3
            const scale = 0.7 + Math.random() * 0.7;

            container.style.transform = `rotate(${verticalAngle}deg) scale(${scale})` + (upsideDown ? ' scaleY(-1)' : '');

            // Assemble and add to page
            container.appendChild(plane);
            container.appendChild(tail);
            document.body.appendChild(container);

            // Create code element for hover display
            let codeElement = null;
            let currentPlaneX = startX;
            let currentPlaneY = startY;

            // Hover event handlers
            container.addEventListener('mouseenter', () => {
                if (!codeElement) {
                    codeElement = document.createElement('div');
                    codeElement.className = 'airline-code revealed';
                    codeElement.textContent = randomTail;

                    // Scale the pixel coordinates from the original image to the 150px rendered size
                    // plane_right.png coordinates: (307, 120) scaled to 150px = divide by 4
                    // For flipped plane (left-going), X coordinate is mirrored
                    const centerOffsetX = 307 / 4; // Always use plane_right coordinates
                    // For upside down planes, add significant offset to appear below the flipped plane
                    const centerOffsetY = upsideDown ? (120 / 4) + 60 : (120 / 4) - 15;

                    // Position at current plane location + scaled center of mass offset
                    const codeX = currentPlaneX + centerOffsetX * scale;
                    const codeY = currentPlaneY + centerOffsetY * scale;

                    codeElement.style.left = codeX + 'px';
                    codeElement.style.top = codeY + 'px';

                    document.body.appendChild(codeElement);

                    // Fade out after 2 seconds
                    setTimeout(() => {
                        if (codeElement && codeElement.parentNode) {
                            codeElement.classList.remove('revealed');
                            codeElement.classList.add('fade-out');
                            setTimeout(() => {
                                if (codeElement && codeElement.parentNode) {
                                    codeElement.remove();
                                    codeElement = null;
                                }
                            }, 2000); // Wait for fade transition
                        }
                    }, 2000); // Show for 2 seconds
                }
            });

            container.addEventListener('mouseleave', () => {
                // Don't remove on mouseleave - let it fade naturally
            });

            // Click to view airline info
            container.addEventListener('click', () => {
                window.location.href = `airline-info.html?code=${encodeURIComponent(randomTail)}&ref=planespotting`;
            });

            // Animate plane
            const duration = 5000 + Math.random() * 5000; // 5-10 seconds
            const startTime = Date.now();

            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = elapsed / duration;

                if (progress >= 1) {
                    container.remove();
                    if (codeElement) {
                        codeElement.remove();
                    }
                    return;
                }

                currentPlaneX = startX + (endX - startX) * progress;
                currentPlaneY = startY + (endY - startY) * progress;

                container.style.left = currentPlaneX + 'px';
                container.style.top = currentPlaneY + 'px';

                requestAnimationFrame(animate);
            }

            animate();
        }

        // Create planes at random intervals
        function scheduleNextPlane() {
            const delay = 1000 + Math.random() * 3000; // 1-4 seconds
            setTimeout(() => {
                createPlane();
                scheduleNextPlane();
            }, delay);
        }

        scheduleNextPlane();
        createPlane(); // Create first plane immediately
    </script>
</body>
</html>
